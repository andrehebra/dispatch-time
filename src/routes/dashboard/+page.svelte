<script>
    /*
    let userBackup = [
    {
        "id": "09wjLxpnUzeRNwylKMEfi4o60vc2",
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "clockIn": [
            {
                "seconds": 1716419879,
                "nanoseconds": 870000000
            },
            {
                "seconds": 1716419882,
                "nanoseconds": 877000000
            }
        ],
        "email": "andre@gmail.com",
        "times": [
            {
                "totalTime": 0.00040194444444444446,
                "clockIn": {
                    "seconds": 1716419879,
                    "nanoseconds": 870000000
                },
                "clockOut": {
                    "seconds": 1716419881,
                    "nanoseconds": 317000000
                },
                "clockInTime": "19:17",
                "clockInDate": "2024-05-22",
                "clockOutTime": "19:18",
                "clockOutDate": "2024-05-22"
            },
            {
                "clockIn": {
                    "seconds": 1716419882,
                    "nanoseconds": 877000000
                },
                "totalTime": 0.0004966666666666666,
                "clockOut": {
                    "seconds": 1716419884,
                    "nanoseconds": 665000000
                },
                "clockInTime": "19:18",
                "clockInDate": "2024-05-22",
                "clockOutTime": "19:18",
                "clockOutDate": "2024-05-22"
            }
        ],
        "todos": []
    },
    {
        "id": "4fIW99v8dpS4MfQTnQsoOY2Qivl1",
        "clockIn": [
            {
                "seconds": 1716546833,
                "nanoseconds": 962000000
            }
        ],
        "clockOut": [
            "CURRENTLY CLOCKED IN"
        ],
        "times": [
            {
                "clockIn": {
                    "seconds": 1716546833,
                    "nanoseconds": 962000000
                },
                "totalTime": null,
                "clockOut": {
                    "seconds": 1716584400,
                    "nanoseconds": 94000000
                },
                "clockInTime": "06:33",
                "clockInDate": "2024-05-24",
                "clockOutTime": "17:00",
                "clockOutDate": "2024-05-24"
            }
        ],
        "todos": [],
        "email": "hobbsjohn2000@gmial.com"
    },
    {
        "id": "691DpeS3ATWdkFygcrC0cefMxLl1",
        "Name": "Andre Hebra",
        "email": "andrehebra@gmail.com",
        "times": [
            {
                "clockOut": {
                    "seconds": 1716592278,
                    "nanoseconds": 656000000
                },
                "clockIn": {
                    "seconds": 1716588269,
                    "nanoseconds": 709000000
                },
                "totalTime": 1.113596388888889,
                "clockInTime": "18:04",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:11",
                "clockOutDate": "2024-05-24"
            },
            {
                "location": [
                    28.5099985,
                    -81.3384939
                ],
                "totalTime": 0.00036833333333333336,
                "clockOut": {
                    "seconds": 1716592282,
                    "nanoseconds": 488000000
                },
                "clockIn": {
                    "seconds": 1716592281,
                    "nanoseconds": 162000000
                },
                "clockInTime": "19:11",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:11",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.00041,
                "location": [
                    28.5099985,
                    -81.3384939
                ],
                "clockOut": {
                    "seconds": 1716592285,
                    "nanoseconds": 601000000
                },
                "clockIn": {
                    "seconds": 1716592284,
                    "nanoseconds": 125000000
                },
                "clockInTime": "19:11",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:11",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.0003686111111111111,
                "location": [
                    28.5099985,
                    -81.3384939
                ],
                "clockOut": {
                    "seconds": 1716592288,
                    "nanoseconds": 174000000
                },
                "clockIn": {
                    "seconds": 1716592286,
                    "nanoseconds": 847000000
                },
                "clockInTime": "19:11",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:11",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockOut": "CURRENTLY CLOCKED IN",
                "location": [
                    28.5099985,
                    -81.3384939
                ],
                "totalTime": 0.00032888888888888887,
                "clockIn": {
                    "seconds": 1716549089,
                    "nanoseconds": 26000000
                },
                "clockInTime": "07:11",
                "clockInDate": "2024-05-24",
                "clockOutTime": "CURRENTLY CLOCKED IN",
                "clockOutDate": "CURRENTLY CLOCKED IN"
            }
        ],
        "todos": [],
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "clockIn": [
            {
                "seconds": 1716588269,
                "nanoseconds": 709000000
            },
            {
                "seconds": 1716592281,
                "nanoseconds": 3000000
            },
            {
                "seconds": 1716592284,
                "nanoseconds": 123000000
            },
            {
                "seconds": 1716592286,
                "nanoseconds": 846000000
            },
            {
                "seconds": 1716592289,
                "nanoseconds": 636000000
            }
        ]
    },
    {
        "id": "6YArSR3GTWMvvQI7mG0g2crFiZk2",
        "todos": [],
        "email": "chaseharden38@gmail.com",
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "times": [
            {
                "clockOut": {
                    "seconds": 1716238805,
                    "nanoseconds": 638000000
                },
                "totalTime": 10.4166666,
                "clockIn": {
                    "seconds": 1716201300,
                    "nanoseconds": 646000000
                },
                "clockInTime": "06:35",
                "clockInDate": "2024-05-20",
                "clockOutTime": "17:00",
                "clockOutDate": "2024-05-20"
            },
            {
                "clockOut": {
                    "seconds": 1716498716,
                    "nanoseconds": 776000000
                },
                "clockIn": {
                    "seconds": 1716460347,
                    "nanoseconds": 488000000
                },
                "totalTime": 10.658135555555555,
                "clockInTime": "06:32",
                "clockInDate": "2024-05-23",
                "clockOutTime": "17:11",
                "clockOutDate": "2024-05-23"
            },
            {
                "clockOut": {
                    "seconds": 1716843337,
                    "nanoseconds": 701000000
                },
                "clockIn": {
                    "seconds": 1716808818,
                    "nanoseconds": 528000000
                },
                "totalTime": 9.588659166666666,
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockInTime": "07:20",
                "clockInDate": "2024-05-27",
                "clockOutTime": "16:55",
                "clockOutDate": "2024-05-27"
            },
            {
                "clockIn": {
                    "seconds": 1716918985,
                    "nanoseconds": 893000000
                },
                "clockOut": {
                    "seconds": 1716943839,
                    "nanoseconds": 153000000
                },
                "totalTime": 6.903683333333333,
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockInTime": "13:56",
                "clockInDate": "2024-05-28",
                "clockOutTime": "20:50",
                "clockOutDate": "2024-05-29"
            },
            {
                "totalTime": 7.755760555555556,
                "clockIn": {
                    "seconds": 1717063539,
                    "nanoseconds": 725000000
                },
                "clockOut": {
                    "seconds": 1717091460,
                    "nanoseconds": 463000000
                },
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockInTime": "06:05",
                "clockInDate": "2024-05-30",
                "clockOutTime": "13:51",
                "clockOutDate": "2024-05-30"
            },
            {
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockIn": {
                    "seconds": 1717408906,
                    "nanoseconds": 518000000
                },
                "totalTime": 8.008060555555556,
                "clockOut": {
                    "seconds": 1717437735,
                    "nanoseconds": 536000000
                },
                "clockInTime": "06:01",
                "clockInDate": "2024-06-03",
                "clockOutTime": "14:02",
                "clockOutDate": "2024-06-03"
            }
        ],
        "Name": "Chase Harden",
        "clockIn": [
            {
                "seconds": 1716221179,
                "nanoseconds": 410000000
            },
            {
                "seconds": 1716460347,
                "nanoseconds": 487000000
            },
            {
                "seconds": 1716808808,
                "nanoseconds": 225000000
            },
            {
                "seconds": 1716918985,
                "nanoseconds": 846000000
            },
            {
                "seconds": 1717063539,
                "nanoseconds": 654000000
            },
            {
                "seconds": 1717091436,
                "nanoseconds": 139000000
            },
            {
                "seconds": 1717408905,
                "nanoseconds": 117000000
            }
        ]
    },
    {
        "id": "J2S4Cdhmsfax9U4lFd2qQMTaFKi1",
        "todos": [],
        "times": [
            {
                "clockOut": {
                    "seconds": 1716420005,
                    "nanoseconds": 971000000
                },
                "totalTime": 0.0004275,
                "clockIn": {
                    "seconds": 1716420004,
                    "nanoseconds": 432000000
                },
                "clockInTime": "19:20",
                "clockInDate": "2024-05-22",
                "clockOutTime": "19:20",
                "clockOutDate": "2024-05-22"
            },
            {
                "totalTime": 0.00043472222222222225,
                "clockIn": {
                    "seconds": 1716420007,
                    "nanoseconds": 750000000
                },
                "clockOut": {
                    "seconds": 1716420009,
                    "nanoseconds": 315000000
                },
                "clockInTime": "19:20",
                "clockInDate": "2024-05-22",
                "clockOutTime": "19:20",
                "clockOutDate": "2024-05-22"
            },
            {
                "totalTime": 0.0007030555555555555,
                "clockOut": {
                    "seconds": 1716420014,
                    "nanoseconds": 32000000
                },
                "clockIn": {
                    "seconds": 1716420011,
                    "nanoseconds": 501000000
                },
                "clockInTime": "19:20",
                "clockInDate": "2024-05-22",
                "clockOutTime": "19:20",
                "clockOutDate": "2024-05-22"
            }
        ],
        "email": "lose@gmail.com",
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "clockIn": [
            {
                "seconds": 1716420004,
                "nanoseconds": 432000000
            },
            {
                "seconds": 1716420007,
                "nanoseconds": 750000000
            },
            {
                "seconds": 1716420011,
                "nanoseconds": 501000000
            }
        ]
    },
    {
        "id": "MaGtmsWPlrUI5Yk1fhvYTZYvuW53",
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "times": [
            {
                "location": [
                    36.6674,
                    -78.39
                ],
                "totalTime": 9.585696944444445,
                "clockOut": {
                    "seconds": 1716843362,
                    "nanoseconds": 62000000
                },
                "clockIn": {
                    "seconds": 1716808853,
                    "nanoseconds": 553000000
                },
                "clockInTime": "07:20",
                "clockInDate": "2024-05-27",
                "clockOutTime": "16:56",
                "clockOutDate": "2024-05-27"
            },
            {
                "clockOut": {
                    "seconds": 1717202801,
                    "nanoseconds": 94000000
                },
                "totalTime": 7.186961944444445,
                "clockIn": {
                    "seconds": 1717176928,
                    "nanoseconds": 31000000
                },
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockInTime": "13:35",
                "clockInDate": "2024-05-31",
                "clockOutTime": "20:46",
                "clockOutDate": "2024-06-01"
            },
            {
                "clockIn": {
                    "seconds": 1717235892,
                    "nanoseconds": 721000000
                },
                "totalTime": null,
                "clockOut": {
                    "seconds": 1717264446,
                    "nanoseconds": 418000000
                },
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockInTime": "05:58",
                "clockInDate": "2024-06-01",
                "clockOutTime": "13:54",
                "clockOutDate": "2024-06-01"
            },
            {
                "clockOut": {
                    "seconds": 1716584400,
                    "nanoseconds": 542000000
                },
                "clockIn": {
                    "seconds": 1716546833,
                    "nanoseconds": 814000000
                },
                "clockInTime": "06:33",
                "clockInDate": "2024-05-24",
                "clockOutTime": "17:00",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 8.0063025,
                "clockIn": {
                    "seconds": 1717322492,
                    "nanoseconds": 801000000
                },
                "location": [
                    28.548479854695785,
                    -81.33672388136773
                ],
                "clockOut": {
                    "seconds": 1717351315,
                    "nanoseconds": 490000000
                },
                "clockInTime": "06:01",
                "clockInDate": "2024-06-02",
                "clockOutTime": "14:01",
                "clockOutDate": "2024-06-02"
            }
        ],
        "clockIn": [
            {
                "seconds": 1716808853,
                "nanoseconds": 513000000
            },
            {
                "seconds": 1717176927,
                "nanoseconds": 985000000
            },
            {
                "seconds": 1717235892,
                "nanoseconds": 547000000
            },
            {
                "seconds": 1717322490,
                "nanoseconds": 249000000
            }
        ],
        "email": "hobbsjohn2000@gmail.com",
        "todos": [],
        "Name": "John Hobbs"
    },
    {
        "id": "PzHTuv5VaAdMQsgp0RFGSlJR9lJ2",
        "clockOut": [],
        "times": [],
        "clockIn": [],
        "email": "jonathan@ftpros.com",
        "todos": []
    },
    {
        "id": "b2asBlsPYQUyXpmGGuA99EykK5E2",
        "Name": "Nick Reynolds",
        "todos": [],
        "times": [
            {
                "clockOut": {
                    "seconds": 1716411922,
                    "nanoseconds": 348000000
                },
                "clockIn": {
                    "seconds": 1716373919,
                    "nanoseconds": 751000000
                },
                "totalTime": 10.556276944444445,
                "clockInTime": "06:31",
                "clockInDate": "2024-05-22",
                "clockOutTime": "17:05",
                "clockOutDate": "2024-05-22"
            },
            {
                "totalTime": 10.81942861111111,
                "clockIn": {
                    "seconds": 1716546800,
                    "nanoseconds": 386000000
                },
                "clockOut": {
                    "seconds": 1716585750,
                    "nanoseconds": 329000000
                },
                "clockInTime": "06:33",
                "clockInDate": "2024-05-24",
                "clockOutTime": "17:22",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 7.827912222222222,
                "clockIn": {
                    "seconds": 1716890695,
                    "nanoseconds": 913000000
                },
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockOut": {
                    "seconds": 1716918876,
                    "nanoseconds": 397000000
                },
                "clockInTime": "06:04",
                "clockInDate": "2024-05-28",
                "clockOutTime": "13:54",
                "clockOutDate": "2024-05-28"
            },
            {
                "totalTime": 8.1670925,
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockOut": {
                    "seconds": 1717006329,
                    "nanoseconds": 134000000
                },
                "clockIn": {
                    "seconds": 1716976927,
                    "nanoseconds": 601000000
                },
                "clockInTime": "06:02",
                "clockInDate": "2024-05-29",
                "clockOutTime": "14:12",
                "clockOutDate": "2024-05-29"
            },
            {
                "totalTime": 7.490301944444444,
                "clockIn": {
                    "seconds": 1717149776,
                    "nanoseconds": 869000000
                },
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockOut": {
                    "seconds": 1717176741,
                    "nanoseconds": 956000000
                },
                "clockInTime": "06:02",
                "clockInDate": "2024-05-31",
                "clockOutTime": "13:32",
                "clockOutDate": "2024-05-31"
            },
            {
                "totalTime": 7.148911666666667,
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockOut": {
                    "seconds": 1717463233,
                    "nanoseconds": 887000000
                },
                "clockIn": {
                    "seconds": 1717437497,
                    "nanoseconds": 805000000
                },
                "clockInTime": "13:58",
                "clockInDate": "2024-06-03",
                "clockOutTime": "21:07",
                "clockOutDate": "2024-06-04"
            },
            {
                "clockOut": "CURRENTLY CLOCKED IN",
                "totalTime": null,
                "clockIn": {
                    "seconds": 1717495200,
                    "nanoseconds": 114000000
                },
                "location": [
                    36.6674,
                    -78.39
                ],
                "clockInTime": "06:00",
                "clockInDate": "2024-06-04",
                "clockOutTime": "CURRENTLY CLOCKED IN",
                "clockOutDate": "CURRENTLY CLOCKED IN"
            }
        ],
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "clockIn": [
            {
                "seconds": 1716383735,
                "nanoseconds": 467000000
            },
            {
                "seconds": 1716546800,
                "nanoseconds": 386000000
            },
            {
                "seconds": 1716890695,
                "nanoseconds": 838000000
            },
            {
                "seconds": 1716976927,
                "nanoseconds": 562000000
            },
            {
                "seconds": 1717149776,
                "nanoseconds": 469000000
            },
            {
                "seconds": 1717437493,
                "nanoseconds": 440000000
            },
            {
                "seconds": 1717495197,
                "nanoseconds": 330000000
            }
        ],
        "email": "nicholas.j.reynolds03@gmail.com"
    },
    {
        "id": "ifpThs2mtfStu2B8N73q1U4QJ5q1",
        "todos": [],
        "Name": "Eddie Jackson",
        "clockIn": [
            {
                "seconds": 1716287120,
                "nanoseconds": 302000000
            },
            {
                "seconds": 1716632842,
                "nanoseconds": 538000000
            },
            {
                "seconds": 1716635669,
                "nanoseconds": 952000000
            },
            {
                "seconds": 1716635770,
                "nanoseconds": 473000000
            },
            {
                "seconds": 1716719248,
                "nanoseconds": 158000000
            },
            {
                "seconds": 1717005221,
                "nanoseconds": 886000000
            },
            {
                "seconds": 1717091463,
                "nanoseconds": 966000000
            },
            {
                "seconds": 1717264121,
                "nanoseconds": 871000000
            },
            {
                "seconds": 1717351311,
                "nanoseconds": 901000000
            }
        ],
        "times": [
            {
                "clockOut": {
                    "seconds": 1716326605,
                    "nanoseconds": 557000000
                },
                "totalTime": 10.968126388888889,
                "clockIn": {
                    "seconds": 1716287120,
                    "nanoseconds": 302000000
                },
                "clockInTime": "06:25",
                "clockInDate": "2024-05-21",
                "clockOutTime": "17:23",
                "clockOutDate": "2024-05-21"
            },
            {
                "clockOut": {
                    "seconds": 1716671148,
                    "nanoseconds": 345000000
                },
                "clockIn": {
                    "seconds": 1716632843,
                    "nanoseconds": 525000000
                },
                "location": [
                    28.548341922737816,
                    -81.33667830194257
                ],
                "totalTime": 10.640227777777778,
                "clockInTime": "06:27",
                "clockInDate": "2024-05-25",
                "clockOutTime": "17:05",
                "clockOutDate": "2024-05-25"
            },
            {
                "location": [
                    28.54882651081537,
                    -81.33661856384072
                ],
                "clockOut": {
                    "seconds": 1716757704,
                    "nanoseconds": 591000000
                },
                "clockIn": {
                    "seconds": 1716719248,
                    "nanoseconds": 183000000
                },
                "totalTime": 10.682335555555555,
                "clockInTime": "06:27",
                "clockInDate": "2024-05-26",
                "clockOutTime": "17:08",
                "clockOutDate": "2024-05-26"
            },
            {
                "clockOut": {
                    "seconds": 1717032830,
                    "nanoseconds": 60000000
                },
                "location": [
                    28.54839777232951,
                    -81.3366902360708
                ],
                "clockIn": {
                    "seconds": 1717005225,
                    "nanoseconds": 33000000
                },
                "totalTime": 7.668063055555556,
                "clockInTime": "13:53",
                "clockInDate": "2024-05-29",
                "clockOutTime": "21:33",
                "clockOutDate": "2024-05-30"
            },
            {
                "clockIn": {
                    "seconds": 1717091466,
                    "nanoseconds": 161000000
                },
                "totalTime": 7.6147672222222225,
                "location": [
                    28.548412588975804,
                    -81.33669726281609
                ],
                "clockOut": {
                    "seconds": 1717118879,
                    "nanoseconds": 323000000
                },
                "clockInTime": "13:51",
                "clockInDate": "2024-05-30",
                "clockOutTime": "21:27",
                "clockOutDate": "2024-05-31"
            },
            {
                "clockOut": {
                    "seconds": 1717286812,
                    "nanoseconds": 222000000
                },
                "totalTime": 6.302443611111111,
                "clockIn": {
                    "seconds": 1717264123,
                    "nanoseconds": 425000000
                },
                "location": [
                    28.548413866970925,
                    -81.33669464543244
                ],
                "clockInTime": "13:48",
                "clockInDate": "2024-06-01",
                "clockOutTime": "20:06",
                "clockOutDate": "2024-06-02"
            },
            {
                "clockOut": {
                    "seconds": 1717378014,
                    "nanoseconds": 299000000
                },
                "clockIn": {
                    "seconds": 1717351313,
                    "nanoseconds": 981000000
                },
                "location": [
                    28.548427290342207,
                    -81.33670526026268
                ],
                "totalTime": 7.416755,
                "clockInTime": "14:01",
                "clockInDate": "2024-06-02",
                "clockOutTime": "21:26",
                "clockOutDate": "2024-06-03"
            }
        ],
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "email": "bocajack03@gmail.com"
    },
    {
        "id": "oPCzQd7WWhOK4LN3GfndVo8xutR2",
        "clockOut": [
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN",
            "CURRENTLY CLOCKED IN"
        ],
        "todos": [],
        "times": [
            {
                "clockOut": {
                    "seconds": 1716588840,
                    "nanoseconds": 662000000
                },
                "totalTime": 0.019029166666666666,
                "clockIn": {
                    "seconds": 1716588772,
                    "nanoseconds": 157000000
                },
                "clockInTime": "18:12",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:14",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.004127222222222222,
                "clockOut": {
                    "seconds": 1716589113,
                    "nanoseconds": 790000000
                },
                "clockIn": {
                    "seconds": 1716589098,
                    "nanoseconds": 932000000
                },
                "clockInTime": "18:18",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:18",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockIn": {
                    "seconds": 1716589115,
                    "nanoseconds": 906000000
                },
                "clockOut": {
                    "seconds": 1716589117,
                    "nanoseconds": 899000000
                },
                "totalTime": 0.0005536111111111111,
                "clockInTime": "18:18",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:18",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockIn": {
                    "seconds": 1716589534,
                    "nanoseconds": 836000000
                },
                "totalTime": 0.0009994444444444445,
                "clockOut": {
                    "seconds": 1716589538,
                    "nanoseconds": 434000000
                },
                "clockInTime": "18:25",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:25",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockOut": {
                    "seconds": 1716590313,
                    "nanoseconds": 293000000
                },
                "clockIn": {
                    "seconds": 1716590310,
                    "nanoseconds": 833000000
                },
                "totalTime": 0.0006833333333333333,
                "clockInTime": "18:38",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:38",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockOut": {
                    "seconds": 1716590758,
                    "nanoseconds": 136000000
                },
                "clockIn": {
                    "seconds": 1716590744,
                    "nanoseconds": 328000000
                },
                "totalTime": 0.0038355555555555556,
                "clockInTime": "18:45",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:45",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.008405833333333333,
                "clockIn": {
                    "seconds": 1716590812,
                    "nanoseconds": 460000000
                },
                "clockOut": {
                    "seconds": 1716590842,
                    "nanoseconds": 721000000
                },
                "clockInTime": "18:46",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:47",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.0035083333333333334,
                "clockIn": {
                    "seconds": 1716590855,
                    "nanoseconds": 861000000
                },
                "clockOut": {
                    "seconds": 1716590868,
                    "nanoseconds": 491000000
                },
                "clockInTime": "18:47",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:47",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.0006102777777777777,
                "clockOut": {
                    "seconds": 1716590873,
                    "nanoseconds": 178000000
                },
                "clockIn": {
                    "seconds": 1716590870,
                    "nanoseconds": 981000000
                },
                "clockInTime": "18:47",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:47",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.028785555555555557,
                "clockOut": {
                    "seconds": 1716591025,
                    "nanoseconds": 835000000
                },
                "clockIn": {
                    "seconds": 1716590922,
                    "nanoseconds": 207000000
                },
                "clockInTime": "18:48",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:50",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.0007752777777777777,
                "clockIn": {
                    "seconds": 1716591255,
                    "nanoseconds": 486000000
                },
                "clockOut": {
                    "seconds": 1716591258,
                    "nanoseconds": 277000000
                },
                "clockInTime": "18:54",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:54",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.006014444444444445,
                "clockOut": {
                    "seconds": 1716591330,
                    "nanoseconds": 291000000
                },
                "clockIn": {
                    "seconds": 1716591308,
                    "nanoseconds": 639000000
                },
                "clockInTime": "18:55",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:55",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockOut": {
                    "seconds": 1716591437,
                    "nanoseconds": 564000000
                },
                "totalTime": 0.0007208333333333333,
                "clockIn": {
                    "seconds": 1716591434,
                    "nanoseconds": 969000000
                },
                "clockInTime": "18:57",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:57",
                "clockOutDate": "2024-05-24"
            },
            {
                "location": "HELLO",
                "clockIn": {
                    "seconds": 1716591470,
                    "nanoseconds": 258000000
                },
                "clockOut": {
                    "seconds": 1716591494,
                    "nanoseconds": 745000000
                },
                "totalTime": 0.006801944444444445,
                "clockInTime": "18:57",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:58",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.005694166666666667,
                "clockOut": {
                    "seconds": 1716591519,
                    "nanoseconds": 15000000
                },
                "clockIn": {
                    "seconds": 1716591498,
                    "nanoseconds": 516000000
                },
                "location": "asdf",
                "clockInTime": "18:58",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:58",
                "clockOutDate": "2024-05-24"
            },
            {
                "location": null,
                "clockOut": {
                    "seconds": 1716591569,
                    "nanoseconds": 137000000
                },
                "clockIn": {
                    "seconds": 1716591560,
                    "nanoseconds": 76000000
                },
                "totalTime": 0.0025169444444444445,
                "clockInTime": "18:59",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:59",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.0038916666666666665,
                "location": null,
                "clockIn": {
                    "seconds": 1716591571,
                    "nanoseconds": 709000000
                },
                "clockOut": {
                    "seconds": 1716591585,
                    "nanoseconds": 719000000
                },
                "clockInTime": "18:59",
                "clockInDate": "2024-05-24",
                "clockOutTime": "18:59",
                "clockOutDate": "2024-05-24"
            },
            {
                "totalTime": 0.012428888888888889,
                "location": [
                    28.5099651,
                    -81.3384631
                ],
                "clockOut": {
                    "seconds": 1716591651,
                    "nanoseconds": 737000000
                },
                "clockIn": {
                    "seconds": 1716591606,
                    "nanoseconds": 993000000
                },
                "clockInTime": "19:00",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:00",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockIn": {
                    "seconds": 1716591691,
                    "nanoseconds": 218000000
                },
                "clockOut": {
                    "seconds": 1716591699,
                    "nanoseconds": 349000000
                },
                "location": [
                    40.6986772,
                    -73.9859414
                ],
                "totalTime": 0.002258611111111111,
                "clockInTime": "19:01",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:01",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockOut": {
                    "seconds": 1716591849,
                    "nanoseconds": 42000000
                },
                "clockIn": {
                    "seconds": 1716591703,
                    "nanoseconds": 782000000
                },
                "totalTime": 0.04035,
                "location": [
                    40.6986772,
                    -73.9859414
                ],
                "clockInTime": "19:01",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:04",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockOut": {
                    "seconds": 1716591990,
                    "nanoseconds": 145000000
                },
                "totalTime": 0.03838111111111111,
                "clockIn": {
                    "seconds": 1716591851,
                    "nanoseconds": 973000000
                },
                "location": [
                    40.6986772,
                    -73.9859414
                ],
                "clockInTime": "19:04",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:06",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockOut": {
                    "seconds": 1716592013,
                    "nanoseconds": 832000000
                },
                "location": [
                    28.5101253,
                    -81.3383563
                ],
                "clockIn": {
                    "seconds": 1716591998,
                    "nanoseconds": 234000000
                },
                "totalTime": 0.004332777777777777,
                "clockInTime": "19:06",
                "clockInDate": "2024-05-24",
                "clockOutTime": "19:06",
                "clockOutDate": "2024-05-24"
            },
            {
                "clockIn": {
                    "seconds": 1716592018,
                    "nanoseconds": 858000000
                },
                "clockOut": {
                    "seconds": 1716598078,
                    "nanoseconds": 544000000
                },
                "totalTime": 1.6832461111111112,
                "location": [
                    40.6986772,
                    -73.9859414
                ],
                "clockInTime": "19:06",
                "clockInDate": "2024-05-24",
                "clockOutTime": "20:47",
                "clockOutDate": "2024-05-25"
            },
            {
                "totalTime": 0.00068,
                "clockOut": {
                    "seconds": 1716598085,
                    "nanoseconds": 834000000
                },
                "clockIn": {
                    "seconds": 1716598083,
                    "nanoseconds": 386000000
                },
                "location": [
                    40.6986772,
                    -73.9859414
                ],
                "clockInTime": "20:48",
                "clockInDate": "2024-05-25",
                "clockOutTime": "20:48",
                "clockOutDate": "2024-05-25"
            },
            {
                "location": [
                    28.5101691,
                    -81.3383452
                ],
                "totalTime": 0.002706388888888889,
                "clockIn": {
                    "seconds": 1716598122,
                    "nanoseconds": 345000000
                },
                "clockOut": {
                    "seconds": 1716598132,
                    "nanoseconds": 88000000
                },
                "clockInTime": "20:48",
                "clockInDate": "2024-05-25",
                "clockOutTime": "20:48",
                "clockOutDate": "2024-05-25"
            },
            {
                "clockOut": {
                    "seconds": 1716599586,
                    "nanoseconds": 16000000
                },
                "location": [
                    28.5101255,
                    -81.3383546
                ],
                "totalTime": 0.001441111111111111,
                "clockIn": {
                    "seconds": 1716599580,
                    "nanoseconds": 828000000
                },
                "clockInTime": "21:13",
                "clockInDate": "2024-05-25",
                "clockOutTime": "21:13",
                "clockOutDate": "2024-05-25"
            },
            {
                "clockIn": {
                    "seconds": 1716599685,
                    "nanoseconds": 530000000
                },
                "clockOut": {
                    "seconds": 1716599690,
                    "nanoseconds": 331000000
                },
                "location": [
                    28.5100725,
                    -81.3384319
                ],
                "totalTime": 0.0013336111111111112,
                "clockInTime": "21:14",
                "clockInDate": "2024-05-25",
                "clockOutTime": "21:14",
                "clockOutDate": "2024-05-25"
            }
        ],
        "clockIn": [
            {
                "seconds": 1716588772,
                "nanoseconds": 157000000
            },
            {
                "seconds": 1716588838,
                "nanoseconds": 877000000
            },
            {
                "seconds": 1716589098,
                "nanoseconds": 932000000
            },
            {
                "seconds": 1716589115,
                "nanoseconds": 906000000
            },
            {
                "seconds": 1716589534,
                "nanoseconds": 836000000
            },
            {
                "seconds": 1716590310,
                "nanoseconds": 833000000
            },
            {
                "seconds": 1716590744,
                "nanoseconds": 328000000
            },
            {
                "seconds": 1716590812,
                "nanoseconds": 460000000
            },
            {
                "seconds": 1716590855,
                "nanoseconds": 861000000
            },
            {
                "seconds": 1716590870,
                "nanoseconds": 981000000
            },
            {
                "seconds": 1716590922,
                "nanoseconds": 207000000
            },
            {
                "seconds": 1716591255,
                "nanoseconds": 486000000
            },
            {
                "seconds": 1716591308,
                "nanoseconds": 639000000
            },
            {
                "seconds": 1716591434,
                "nanoseconds": 969000000
            },
            {
                "seconds": 1716591470,
                "nanoseconds": 258000000
            },
            {
                "seconds": 1716591498,
                "nanoseconds": 516000000
            },
            {
                "seconds": 1716591559,
                "nanoseconds": 957000000
            },
            {
                "seconds": 1716591571,
                "nanoseconds": 688000000
            },
            {
                "seconds": 1716591606,
                "nanoseconds": 833000000
            },
            {
                "seconds": 1716591691,
                "nanoseconds": 196000000
            },
            {
                "seconds": 1716591703,
                "nanoseconds": 758000000
            },
            {
                "seconds": 1716591851,
                "nanoseconds": 951000000
            },
            {
                "seconds": 1716591995,
                "nanoseconds": 278000000
            },
            {
                "seconds": 1716592018,
                "nanoseconds": 729000000
            },
            {
                "seconds": 1716598073,
                "nanoseconds": 693000000
            },
            {
                "seconds": 1716598083,
                "nanoseconds": 383000000
            },
            {
                "seconds": 1716598122,
                "nanoseconds": 233000000
            },
            {
                "seconds": 1716599580,
                "nanoseconds": 827000000
            },
            {
                "seconds": 1716599685,
                "nanoseconds": 334000000
            }
        ],
        "email": "a@g.com"
    }
]
    */

    import { db } from "../../lib/firebase/firebase";
    import { authHandlers, authStore } from "../../store/store";
    import { getDoc, doc, setDoc } from "firebase/firestore";
    import { collection, getDocs } from "firebase/firestore";
    import TodoItem from "../../components/TodoItem.svelte";

    import { Select } from 'flowbite-svelte';

    import { DateInput } from 'date-picker-svelte';

    let tempDate = new Date();

    let editTimeModal = false;

    let todoList = [];
    let clockInTimes = [];
    let clockOutTimes = [];
    let timeMapArray = [];
    let currTodo = "";
    let error = false;
    let admin = false;
    let adminUsers = [];
    let adminUsersConverted = [];

    const options = { timeZone: 'America/New_York', hour: '2-digit', minute: '2-digit', hour12: false };



    let periodArray = [];
    let currentDate = new Date();
    let periodStartDate = new Date("April 28, 2024 00:00:00");
    let earliestDate = new Date(currentDate);
    earliestDate.setDate(earliestDate.getDate() - 30);
    let nextPeriod = new Date(periodStartDate.getTime());
    
    let tempNextDate = new Date(periodStartDate.getTime() + (13*24*60*60*1000));
    

    
    while (nextPeriod < currentDate) {
        nextPeriod = new Date(nextPeriod.getTime() + (14*24*60*60*1000));
        tempNextDate = new Date(nextPeriod.getTime() + (13*24*60*60*1000));
        if (earliestDate <= nextPeriod) {
            periodArray.push({
                date: nextPeriod,
                ISODate: nextPeriod.toISOString().slice(0, -5),
                value: nextPeriod.toISOString().slice(0, -5),
                name: nextPeriod.toLocaleDateString('en-US') + " - " + tempNextDate.toLocaleDateString('en-US'),
            })
        }
        
        console.log(periodArray);
    }
    let selectedPeriod = nextPeriod;

    let hoursArray = [];
    let totalHours = 0;
    function calculatePayHours() {
        selectedPeriod = new Date(selectedPeriod);

        hoursArray = [];

        let endOfPeriod = new Date(selectedPeriod.getTime() + (14*24*60*60*1000));
        console.log(endOfPeriod);

        for (let i = 0; i < adminUsers.length; i++) {
            if (adminUsers[i].Name != null) {
                totalHours = 0;
                for (let j = 0; j < adminUsers[i].times.length; j++) {
                    if (adminUsers[i].times[j].clockIn.toDate() >= selectedPeriod && adminUsers[i].times[j].clockIn.toDate() <= endOfPeriod) {
                        if (adminUsers[i].times[j].clockOut != "CURRENTLY CLOCKED IN") {
                            totalHours += (Math.abs(adminUsers[i].times[j].clockOut.toDate() - adminUsers[i].times[j].clockIn.toDate()) / (1000 * 60 * 60));
                        }
                    }
                
                }
                hoursArray.push({
                    name: adminUsers[i].Name,
                    hours: Math.round(totalHours * 10) / 10,
                })
            }
            
        }

        console.log(hoursArray);
    }

    let getLocation = () => {
    return new Promise((resolve, reject) => {
      if (!navigator.geolocation) {
        console.error('Geolocation is not supported by your browser');
        resolve(null);
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          resolve([latitude, longitude]);
        },
        (error) => {
          console.error('Error getting location', error);
          resolve(null);
        },
        {
          enableHighAccuracy: true,  // Try to use the most accurate location data available
          timeout: 5000,  // Wait 5 seconds for location data
          maximumAge: 0   // Do not use cached location data
        }
      );
    });
  };

    async function fetchLocation() {
        const location = await getLocation();
        if (location) {
            console.log('Latitude:', location[0], 'Longitude:', location[1]);
        } else {
            console.log('Location permission denied or error occurred');
        }
        
    }

    

    authStore.subscribe((curr) => {
        //todoList = curr.data.todos;
        clockInTimes = curr.data.clockIn;
        clockOutTimes = curr.data.clockOut;
        timeMapArray = curr.data.times;
        if (curr.user != null) {
            if (curr.user.uid != null) {
                if (curr.user.uid == "691DpeS3ATWdkFygcrC0cefMxLl1" || curr.user.uid == "PzHTuv5VaAdMQsgp0RFGSlJR9lJ2") {
                    admin = true;
                    getAllUserTimes();
                }
            }
        }
    });

    function reloadPage() {
        location.reload();
    }

    async function clockIn() {
        error = false;
        if (!currTodo) {
            error = true;
        }
        todoList = [...todoList, [new Date()]];
        clockInTimes = [...clockInTimes, new Date()];
        clockOutTimes = [...clockOutTimes, "CURRENTLY CLOCKED IN"];
        currTodo = "";

        let currentLocation = await getLocation();

        if (currentLocation == null) {
            alert("Unable to clock in, you must allow location access for this tool to work.");
            return;
        }

        

    
        if (timeMapArray.length != 0 && timeMapArray[timeMapArray.length - 1].clockOut == "CURRENTLY CLOCKED IN") {
            alert("Unable to clock in, you are already clocked in!");
            return;
        }

        let currentTimes = {
            clockIn: new Date(),
            clockOut: "CURRENTLY CLOCKED IN",
            totalTime: null,
            location: currentLocation,
        }
        timeMapArray = [...timeMapArray, currentTimes]
        saveTodos();
        console.log(timeMapArray);
        

        
    }

    function clockOut() {
        error = false;
        if (!currTodo) {
            error = true;
        }

        if (timeMapArray.length != 0 && timeMapArray[timeMapArray.length - 1].clockOut == "CURRENTLY CLOCKED IN") {
            timeMapArray[timeMapArray.length - 1].clockOut = new Date();
            timeMapArray[timeMapArray.length - 1].totalTime = (Math.abs(timeMapArray[timeMapArray.length - 1].clockOut - timeMapArray[timeMapArray.length - 1].clockIn.toDate()) / (1000 * 60 * 60));
            saveTodos();
        } else {
            alert("Unable to clock out, you are not clocked in!");
        }

        saveTodos();

        currTodo = "";
    }

    function editTodo(index) {
        let newTodoList = [...todoList].filter((val, i) => {
            console.log(i, index, i !== index);
            return i != index;
        });
        currTodo = todoList[index];
        todoList = newTodoList;
    }

    function removeTodo(index) {
        let newTodoList = [...todoList].filter((val, i) => {
            console.log(i, index, i !== index);
            return i != index;
        });
        todoList = newTodoList;
    }

    async function getAllUserTimes() {
        try {
            const nonAdminUser = collection(db, "users");
            const docSnap = await getDocs(nonAdminUser);
            //const usersData = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            const documents = docSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            //console.log(documents);

            adminUsers = documents;


            let tempDate;
            let tempMMDD;
            let tempHHMM;
            for (let i = 0; i < adminUsers.length; i++) {
                if (adminUsers[i] != null && adminUsers[i].times != null) {
                    for (let j = 0; j < adminUsers[i].times.length; j++) {
                        console.log(adminUsers[i].times[j].clockIn.toDate());
                        tempDate = adminUsers[i].times[j].clockIn.toDate();
                        tempDate = tempDate.toLocaleString('en-US', options);
                        adminUsers[i].times[j].clockInTime = tempDate;

                        tempMMDD = adminUsers[i].times[j].clockIn.toDate().toISOString().substring(0,10)
                        adminUsers[i].times[j].clockInDate = tempMMDD;

                        if (adminUsers[i].times[j].clockOut != "CURRENTLY CLOCKED IN") {
                            tempDate = adminUsers[i].times[j].clockOut.toDate();
                            tempDate = tempDate.toLocaleString('en-US', options);
                            adminUsers[i].times[j].clockOutTime = tempDate;

                            tempMMDD = adminUsers[i].times[j].clockOut.toDate().toISOString().substring(0,10)
                            adminUsers[i].times[j].clockOutDate = tempMMDD;
                        } else {
                            adminUsers[i].times[j].clockOutTime = "CURRENTLY CLOCKED IN";
                            adminUsers[i].times[j].clockOutDate = "CURRENTLY CLOCKED IN";
                        }
                        
                    }
                }
            }

            /*
            for (let i = 0; i < documents.length; i++) {
                if (adminUsers[i].Name != null) {
                    adminUsersConverted.push(
                        {
                            email: documents[i].email,
                            id: documents[i].id,
                            times: documents[i].times,
                            Name: documents[i].Name
                        }
                    );

                    //console.log(adminUsersConverted[0].times);

                    for (let j = 0; j < adminUsersConverted[i].times.length; j++) {
                        //console.log(adminUsersConverted[i].times[j]);
                        if (adminUsersConverted[i].times[j] != null) {
                            adminUsersConverted[i].times[j].clockIn = adminUsersConverted[i].times[j].clockIn.toDate();
                        }
                        
                        if (adminUsersConverted[i].times[j].clockOut != null && adminUsersConverted[i].times[j].clockOut != "CURRENTLY CLOCKED IN") {
                            adminUsersConverted[i].times[j].clockOut = adminUsersConverted[i].times[j].clockOut.toDate();
                        }
                    }
                }
                
            }

            */

            //console.log(adminUsersConverted)

            console.log("Admin Users: ");
            console.log(adminUsers);

            adminUsers = adminUsers;

            return documents;
            
            //return usersData;
        } catch (error) {
            console.error("Error fetching users data: ", error);
            throw error;
        }
    }

    async function saveTodos() {
        try {
            const userRef = doc(db, "users", $authStore.user.uid);
            await setDoc(
                userRef,
                {
                    //todos: todoList,
                    clockIn: clockInTimes,
                    clockOut: clockOutTimes,
                    times: timeMapArray,
                },
                { merge: true }
            );
        } catch (err) {
            console.log("There was an error saving your information");
        }

        reloadPage();
    }

    if (admin == true) {
        adminUsers = getAllUserTimes();
    }

    async function updateClockIn(userId, index, updatedClockIn, updatedClockOut) {
    try {
        console.log("Clock In: " + updatedClockIn);
        console.log("Clock Out: " + updatedClockOut);
        const userRef = doc(db, "users", userId);
        const userDoc = await getDoc(userRef);

        if (!userDoc.exists) {
            console.log('No such document!');
            return;
        }

        const userData = userDoc.data();
        if (!Array.isArray(userData.times) || index >= userData.times.length) {
            console.log('Invalid index');
            return;
        }

        userData.times[index].clockIn = updatedClockIn;
        userData.times[index].clockOut = updatedClockOut;
        console.log(userData);

        /*
        await userRef.update({
            clockInArray: userData.times
        });
        */
        await setDoc(
            userRef,
            {
                times: userData.times,
            },
            { merge: true }
        );

        console.log('Document successfully updated!');
    } catch (error) {
        console.error('Error updating document: ', error);
    }

    reloadPage();
}
</script>

{#if !$authStore.loading}
    <div class="mainContainer">
        <div class="headerContainer">
            <h1>FTP Dispatch Time Tracking</h1>
            <div class="headerBtns">
                
                <button on:click={authHandlers.logout}>
                    <i class="fa-solid fa-right-from-bracket" />
                    <p>Logout</p></button
                >
            </div>
        </div>
        <main>
            {#if admin === false}
            <div class={"enterTodo " + (error ? "errorBorder" : "")}>
            
                <button on:click={clockIn}>Clock In</button>
                <button on:click={clockOut}>Clock Out</button>
            </div>
            {#if clockInTimes.length === 0}
                <p>You Currently Have no History!</p>
            {/if}
            {#each timeMapArray as clockInItem, index}
                <div class="todo">
                    <p>
                        {index + 1}. {clockInItem.clockIn.toDate().toLocaleDateString('en-US')} {clockInItem.clockIn.toDate().toLocaleTimeString('en-US')}   -   {clockInItem.clockOut == "CURRENTLY CLOCKED IN" ? "CURRENTLY CLOCKED IN" : clockInItem.clockOut.toDate().toLocaleDateString('en-us')} {clockInItem.clockOut == "CURRENTLY CLOCKED IN" ? "" : clockInItem.clockOut.toDate().toLocaleTimeString('en-us')}
                    </p>
                </div>
            {/each}
            {:else if admin === true}
            <h1>Hours Per Pay Period</h1>
            <Select class="mt-2" on:change={() => {calculatePayHours()}} items={periodArray} bind:value={selectedPeriod} />
            {#if hoursArray != []}
                    <table>
                        <tr>
                            <th>Name</th>
                            <th>Hours</th>
                        </tr>
                    {#each hoursArray as hoursItem}
                        <tr>
                            <td>{hoursItem.name}</td>
                            <td>{hoursItem.hours}</td>
                        </tr>
                    {/each}
                    </table>
                
            {/if}
            <hr>
                {#each adminUsers as user}
                    {#if user.Name != null}
                        <h1>{user.Name}</h1>
                        <div class="personContainer">
                        {#each user.times as clockInItem, index}
                        {#if (clockInItem.clockIn.toDate().getHours() != 5) &&  (clockInItem.clockIn.toDate().getHours() != 13)}
                                <div class="todo late">
                                    <div class="horiz-list">
                                        <input bind:value={clockInItem.clockInDate} type="date" />
                                        <input bind:value={clockInItem.clockInTime} type="time" /> - 
                                        {#if clockInItem.clockOut != "CURRENTLY CLOCKED IN"}
                                            <input bind:value={clockInItem.clockOutDate} type="date" />
                                            <input bind:value={clockInItem.clockOutTime} type="time" />
                                        {:else}
                                            <p>Currently Clocked In</p>
                                        {/if}
                                    </div>
                                    
                                    <div class="options">
                                        {#if clockInItem.location != null && clockInItem.location[0] != null && clockInItem.location[1] != null}
                                            <a href={"https://maps.google.com/?q=" + clockInItem.location[0] + "," + clockInItem.location[1]}>View Location</a>
                                        {/if}

                                        <a on:click="{() => {updateClockIn(user.id, index, new Date(clockInItem.clockInDate + " " + clockInItem.clockInTime), new Date(clockInItem.clockOutDate + " " + clockInItem.clockOutTime))}}">Update Times</a>
                                        
                                    </div>
                                    
                                </div>
                            {:else}
                                <div class="todo">
                                    <div class="horiz-list">
                                        <input bind:value={clockInItem.clockInDate} type="date" />
                                        <input bind:value={clockInItem.clockInTime} type="time" /> - 
                                        {#if clockInItem.clockOut != "CURRENTLY CLOCKED IN"}
                                            <input bind:value={clockInItem.clockOutDate} type="date" />
                                            <input bind:value={clockInItem.clockOutTime} type="time" />
                                        {:else}
                                            <p>Currently Clocked In</p>
                                        {/if}
                                    </div>
                                    
                                    <div class="options">
                                        
                                        {#if clockInItem.location != null && clockInItem.location[0] != null && clockInItem.location[1] != null}
                                            <a href={"https://maps.google.com/?q=" + clockInItem.location[0] + "," + clockInItem.location[1]}>View Location</a>
                                        {/if}
                                        
                                        <a on:click="{() => {updateClockIn(user.id, index, new Date(clockInItem.clockInDate + " " + clockInItem.clockInTime), new Date(clockInItem.clockOutDate + " " + clockInItem.clockOutTime))}}">Update Times</a>
                                    </div>
                                </div>
                            {/if}
                            
                        {/each}
                        </div>
                    {/if}
                {/each}
            {/if}
        </main>
        
    </div>
{/if}



<style>
    .personContainer {
        max-height: 200px;
        overflow-y: scroll;
        display: flex;
        flex-direction: column-reverse;
        gap: 15px;
        justify-content: flex-end;
    }

    .horiz-list {
        display: flex;
        gap: 25px;
    }
    .modal {
        position: fixed;
        top: 0;
        left: 0;
    }

    a, .button {
        background-color: transparent;
        color: white;
        font-size: 0.8rem;
        border: white solid;
        border-width: 2px;
        padding: 2px;
        border-radius: 2px;
    }

    .late {
        background-color: red;
    }
    .todo {
        border-left: 1px solid cyan;
        padding: 8px 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .actions {
        display: flex;
        align-items: center;
        gap: 14px;
        font-size: 1.3rem;
    }

    .actions i {
        cursor: pointer;
    }

    .actions i:hover {
        color: coral;
    }
    .mainContainer {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        gap: 24px;
        padding: 24px;
        width: 100%;
        max-width: 1000px;
        margin: 0 auto;
    }

    .headerContainer {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .headerBtns {
        display: flex;
        align-items: center;
        gap: 14px;
    }

    .headerContainer button {
        background: #003c5b;
        color: white;
        padding: 10px 18px;
        border: none;
        border-radius: 4px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
    }

    .headerContainer button i {
        font-size: 1.1rem;
    }

    .headerContainer button:hover {
        opacity: 0.7;
    }

    main {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
    }

    .enterTodo {
        display: flex;
        width: 250px;
        align-items: stretch;
        border: 1px solid #0891b2;
        border-radius: 10px;
        overflow: hidden;
    }

    .errorBorder {
        border-color: coral !important;
    }

    .enterTodo input {
        background: transparent;
        border: none;
        padding: 14px;
        color: white;
        flex: 1;
    }

    .enterTodo input:focus {
        outline: none;
    }

    .enterTodo button {
        height: 50px;
        width: 125px;
        padding: 0 28px;
        background: #003c5b;
        border: none;
        color: cyan;
        font-weight: 600;
        cursor: pointer;
    }

    .enterTodo button:hover {
        background: transparent;
    }
</style>
